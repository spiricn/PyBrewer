<html>

<head>

<title>PyBrewer ${Brewer.version}</title>

<script>

function toggleRelay() {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'rest/relay/toggle');

    xhr.onload = function() {
        if (xhr.status !== 200) {
            alert('toggle failed: ' + xhr.response);
        }
    };

    xhr.send()
}

function refreshStatus() {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'rest/status');

    xhr.onload = function() {
        var status = JSON.parse(xhr.response);

        document.getElementById("temperature").innerHTML = status.temp + " C";

        document.getElementById("relay_state").innerHTML = (status.relay_on ? 'ON' : 'OFF');

        document.getElementById("temp_control_running").innerHTML = (status.temperature_controller_running ? 'ON' : 'OFF');

        document.getElementById("relayControlButton").disabled = status.temperature_controller_running

        status.temperature_controller_running

        setTimeout(refreshStatus,
            1000)
    };

    xhr.send()
}

function toggleTempControl() {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'rest/temperature/controller/toggle');

    xhr.onload = function() {
        if (xhr.status != 200) {
            alert('toggle failed: ' + xhr.response);
        }
    };

    xhr.send()
}

refreshStatus()


</script>


<style>
    html, body {
        background-color: black;
        width: 100%;
        font-family: "Courier New", Times, serif;
        color: #00ff00;
    }

    td {

        font-weight: bold;
        font-size: large;
        padding: 12px 12px 12px 12px;
    }
    table {
    margin: 0 auto;

    }

    h2 {
    text-decoration: underline;
    }

</style>

<link rel="icon" href="/favicon.png"/>


</head>

<body>


<h1> PyBrewer ${Brewer.version} </h1>
</br>
</br>

<table>

    <tr><td colspan=2> <h2> Temperature </h2> </td></tr>

    <tr>
        <td> Probe temperature </td>
        <td id="temperature"> </td>
    </tr>

    <tr><td></br></td></tr>
    <tr><td colspan=2> <h2> Relay </h2> </td></tr>

    <tr>
        <td> Relay state </td>
        <td id="relay_state"> </td>
        <td> <button id="relayControlButton" onClick="toggleRelay()"> toggle </button> </td>
    </tr>

    <tr><td></br></td></tr>
    <tr><td colspan=2> <h2> Controller </h2> </td></tr>

    <tr>
        <td> Temperature control </td>
        <td id="temp_control_running"> </td>
        <td> <button onClick="toggleTempControl()"> toggle </button> </td>
    </tr>

    <tr>
        <td> Target temperature </td>
        <td> ${Brewer.temperatureControl.targetTemperatureCelsius} </td>
    </tr>

</table>

</body>

</html>
